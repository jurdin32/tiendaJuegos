{% extends 'index.html' %}{% block main %}    <div role="main" class="main shop pb-4">        <div class="container">            <div class="row">                <div class="col">                    <ul class="breadcrumb breadcrumb-dividers-no-opacity font-weight-bold text-6 justify-content-center my-5">                        <li class="text-transform-none me-2">                            <a href="{% url 'carrito' %}"                               class="text-decoration-none text-color-dark text-color-hover-primary">Carrito</a>                        </li>                        <li class="text-transform-none text-color-grey-lighten">                            <a href="#"                               class="text-decoration-none text-color-grey-lighten text-color-hover-primary">Completar                                la orden</a>                        </li>                    </ul>                </div>            </div>            {% if not request.user.username %}                <div class="row">                    <div class="col">                        <p class="mb-1">Iniciar Sesión                            <a href="#"                               class="text-color-dark text-color-hover-primary text-uppercase text-decoration-none font-weight-bold"                               data-bs-toggle="modal"                               data-bs-target="#sesion">Login</a></p>                    </div>                </div>            {% endif %}            <div class="row">                <div class="col-lg-7 mb-4 mb-lg-0">                    <h2 class="text-color-dark font-weight-bold text-5-5 mb-3">Detalles del pago</h2>                    <div class="row">                        <div class="form-group col-md-6">                            <label class="form-label">Nombres <span class="text-color-danger">*</span></label>                            <input type="text" class="form-control h-auto py-2" name="firstName"                                   value="{{ request.user.first_name }}" required/>                        </div>                        <div class="form-group col-md-6">                            <label class="form-label">Apellidos <span class="text-color-danger">*</span></label>                            <input type="text" class="form-control h-auto py-2" name="lastName"                                   value="{{ request.user.last_name }}" required/>                        </div>                    </div>                    <div class="row">                        <div class="form-group col">                            <label class="form-label">Dirección <span                                    class="text-color-danger">*</span></label>                            <input type="text" class="form-control h-auto py-2" name="address1"                                   value="{{ perfil.direccion }}"                                   placeholder="House number and street name" required/>                        </div>                    </div>                    <div class="row">                        <div class="form-group col">                            <label class="form-label">Ciudad <span class="text-color-danger">*</span></label>                            <input type="text" class="form-control h-auto py-2" name="city" value="{{ perfil.ciudad }}"                                   required/>                        </div>                    </div>                    <div class="row">                        <div class="form-group col">                            <label class="form-label">Provincia <span class="text-color-danger">*</span></label>                            <input type="text" class="form-control h-auto py-2" name="zip"                                   value="{{ perfil.provincia }}" required/>                        </div>                    </div>                    <div class="row">                        <div class="form-group col">                            <label class="form-label">Teléfono <span class="text-color-danger">*</span></label>                            <input type="number" class="form-control h-auto py-2" name="phone"                                   value="{{ perfil.telefono }}" required/>                        </div>                    </div>                    <div class="row">                        <div class="form-group col">                            <a class="btn btn-primary" href="{% url 'datos' %}">Actualización de datos</a>                        </div>                    </div>                </div>                <div class="col-lg-5 position-relative">                    <div class="card border-width-3 border-radius-0 border-color-hover-dark" data-plugin-sticky                         data-plugin-options="{'minWidth': 991, 'containerSelector': '.row', 'padding': {'top': 85}}">                        <div class="card-body">                            <h4 class="font-weight-bold text-uppercase text-4 mb-3">Datos de la Orden</h4>                            <form action="" method="post">                                {% csrf_token %}                                <input type="hidden" id="ids" name="ids">                                <input type="hidden" id="cantidades" name="cantidades">                                <input type="hidden" id="subt" name="subtotal">                                <input type="hidden" id="iv" name="iva">                                <input type="hidden" id="ttt" name="total">                                <table class="shop_table cart-totals mb-3">                                    <tbody id="tabla">                                    <tr>                                        <td colspan="2" class="border-top-0">                                            <strong class="text-color-dark">Productos</strong>                                        </td>                                    </tr>                                    </tbody>                                </table>                                <table class="shop_table cart-totals mb-3">                                    <tr class="cart-subtotal">                                        <td class="border-top-0">                                            <strong class="text-color-dark">Subtotal</strong>                                        </td>                                        <td class="border-top-0 text-end">                                            <strong><span class="amount font-weight-medium"                                                          id="subtotal"></span></strong>                                        </td>                                    </tr>                                    <tr class="cart-subtotal">                                        <td class="border-top-0">                                            <strong class="text-color-dark">IVA</strong>                                        </td>                                        <td class="border-top-0 text-end">                                            <strong><span class="amount font-weight-medium" id="iva"></span></strong>                                        </td>                                    </tr>                                    <tr class="total">                                        <td>                                            <strong class="text-color-dark text-3-5">Total</strong>                                        </td>                                        <td class="text-end">                                            <strong class="text-color-dark">                                                <span class="amount text-color-dark text-5" id="total"></span>                                            </strong>                                        </td>                                    </tr>                                </table>                                <button type="submit"                                    class="btn btn-dark btn-modern w-100 text-uppercase bg-color-hover-primary border-color-hover-primary border-radius-0 text-3 py-3"                                    id="pagar"                                >                                    Registrar Pago <i class="fas fa-arrow-right ms-2"></i></button>                            </form>                        </div>                    </div>                </div>            </div>        </div>    </div>{% endblock %}{% block script %}    <script src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>    <script>        console.log(localStorage.length)        for (let i = 0; i < localStorage.length; i++) {            let clave = localStorage.key(i)            let dato = JSON.parse(localStorage.getItem(clave))            console.log(dato.id, dato.nombre)            let tr = document.createElement('tr')            let td1 = document.createElement('td')            td1.className = "border-top-0"            td1.innerHTML = "<strong>" + dato.nombre + "</strong>"            let td2 = document.createElement('td')            td2.className = "border-top-0"            td2.textContent = "$ " + dato.precio            td2.align = 'right'            let td3 = document.createElement('td')            td3.className = "border-top-0"            td3.textContent ="x("+dato.cantidad+")"            td3.align = 'center'            let tabla = document.getElementById('tabla')            tr.appendChild(td1)            tr.appendChild(td3)            tr.appendChild(td2)            tabla.appendChild(tr)        }        function calcularTotal() {            let total = document.getElementById('total')            let iva = document.getElementById('iva')            let subtotal = document.getElementById('subtotal')            let suma = 0            let ids=[]            let cantidades=[]            for (let i = 0; i < localStorage.length; i++) {                let clave = localStorage.key(i)                let item = JSON.parse(localStorage.getItem(clave))                suma += (parseFloat(item.cantidad) * parseFloat(item.precio))                ids.push(item.id)                cantidades.push(item.cantidad)            }            $("#ids").val(ids)            $("#cantidades").val(cantidades)            console.log(suma.toFixed(2))            total.textContent = "$ " + suma.toFixed(2)            let viva = (suma.toFixed(2) * 0.12).toFixed(2)            iva.textContent = "$ " + viva            subtotal.textContent = "$ " + (suma - viva).toFixed(2)            $("#subt").val((suma - viva).toFixed(2))            $("#iv").val(viva)            $("#ttt").val(suma.toFixed(2))        }        calcularTotal()        $("#pagar").click(function(){            localStorage.clear()        })    </script>{% endblock %}